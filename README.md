# container-node-pool-module
GCP Terraform Container Node Pool Module Repo

GCPì—ì„œ GKE(Google Kubernetes Engine) ë…¸ë“œ í’€ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•œ Terraform ëª¨ë“ˆì…ë‹ˆë‹¤. <br> 
ì´ ëª¨ë“ˆì€ ë…¸ë“œ í’€ ìƒì„±, êµ¬ì„±, ê´€ë¦¬, ê·¸ë¦¬ê³  ìë™ í™•ì¥ì„ ì§€ì›í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

<br>

## ğŸ“‘ **ëª©ì°¨**
1. [ëª¨ë“ˆ íŠ¹ì§•](#ëª¨ë“ˆ-íŠ¹ì§•)
2. [ì‚¬ìš© ë°©ë²•](#ì‚¬ìš©-ë°©ë²•)
    1. [ì‚¬ì „ ì¤€ë¹„](#1-ì‚¬ì „-ì¤€ë¹„)
    2. [ì…ë ¥ ë³€ìˆ˜](#2-ì…ë ¥-ë³€ìˆ˜)
    3. [ëª¨ë“ˆ í˜¸ì¶œ ì˜ˆì‹œ](#3-ëª¨ë“ˆ-í˜¸ì¶œ-ì˜ˆì‹œ)
    4. [ì¶œë ¥ê°’ (Outputs)](#4-ì¶œë ¥ê°’-outputs)
    5. [ì§€ì› ë²„ì „](#5-ì§€ì›-ë²„ì „)
    6. [ëª¨ë“ˆ ê°œë°œ ë° ê´€ë¦¬](#6-ëª¨ë“ˆ-ê°œë°œ-ë°-ê´€ë¦¬)
3. [í…ŒìŠ¤íŠ¸](#terratestë¥¼-ì´ìš©í•œ-í…ŒìŠ¤íŠ¸)
4. [ì£¼ìš” ë²„ì „ ê´€ë¦¬](#ì£¼ìš”-ë²„ì „-ê´€ë¦¬)
5. [ê¸°ì—¬](#ê¸°ì—¬-contributing)
6. [ë¼ì´ì„ ìŠ¤](#ë¼ì´ì„ ìŠ¤-license)

---

## ëª¨ë“ˆ íŠ¹ì§•

- GKE ë…¸ë“œ í’€ ìƒì„± ë° ê´€ë¦¬.
- ë‹¤ì–‘í•œ ë…¸ë“œ ì„¤ì • (ë¨¸ì‹  íƒ€ì…, ë””ìŠ¤í¬ í¬ê¸°, ì´ë¯¸ì§€ ìœ í˜• ë“±) ì§€ì›.
- ìë™ í™•ì¥(Autoscaling) ë° ì—…ê·¸ë ˆì´ë“œ(Upgrade) ì„¤ì •.
- ë„¤íŠ¸ì›Œí¬ êµ¬ì„± ë° Taint ì„¤ì • í¬í•¨.
- ì£¼ìš” êµ¬ì„± ìš”ì†Œì˜ ì¶œë ¥ê°’ ì œê³µ.

---

## ì‚¬ìš© ë°©ë²•

### 1. ì‚¬ì „ ì¤€ë¹„

ë‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”:
1. Google Cloud í”„ë¡œì íŠ¸ ì¤€ë¹„.
2. ì ì ˆí•œ IAM ê¶Œí•œ í•„ìš”: `roles/container.admin`, `roles/compute.admin`.

<br>

### 2. ì…ë ¥ ë³€ìˆ˜

| ë³€ìˆ˜ëª…                  | íƒ€ì…             | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’                      | ì„¤ëª…                                                                 |
|-------------------------|------------------|-----------|-----------------------------|----------------------------------------------------------------------|
| `cluster`              | string           | âœ…        | ì—†ìŒ                        | í´ëŸ¬ìŠ¤í„° ì´ë¦„                                                       |
| `name`                 | string           | âŒ        | null                        | ë…¸ë“œ í’€ ì´ë¦„                                                        |
| `name_prefix`          | string           | âŒ        | null                        | ë…¸ë“œ í’€ ì´ë¦„ ì ‘ë‘ì‚¬                                                 |
| `location`             | string           | âŒ        | null                        | ë…¸ë“œ í’€ì´ ìƒì„±ë  ì§€ì—­/ì˜ì—­                                          |
| `project`              | string           | âŒ        | null                        | GCP í”„ë¡œì íŠ¸ ID                                                     |
| `initial_node_count`   | number           | âŒ        | null                        | ì´ˆê¸° ë…¸ë“œ ìˆ˜                                                        |
| `node_count`           | number           | âŒ        | null                        | ê³ ì •ëœ ë…¸ë“œ ìˆ˜                                                      |
| `management`           | object           | âŒ        | `{ auto_repair: true, auto_upgrade: true }` | ë…¸ë“œ ìë™ ê´€ë¦¬ ì˜µì…˜                                                 |
| `max_pods_per_node`    | number           | âŒ        | null                        | ë…¸ë“œ í•˜ë‚˜ë‹¹ ìµœëŒ€ Pod ìˆ˜                                             |
| `node_locations`       | list(string)     | âŒ        | ë¹ˆ ë¦¬ìŠ¤íŠ¸                    | ë…¸ë“œ í’€ì˜ ë…¸ë“œê°€ ë°°ì¹˜ë  ì˜ì—­ ëª©ë¡                                   |
| `node_config`          | object           | âŒ        | null                        | ë…¸ë“œ êµ¬ì„± ì„¤ì •                                                      |
| `network_config`       | object           | âŒ        | null                        | ë„¤íŠ¸ì›Œí¬ êµ¬ì„± ì„¤ì •                                                  |
| `upgrade_settings`     | object           | âŒ        | null                        | ì—…ê·¸ë ˆì´ë“œ ì„¤ì •                                                     |
| `placement_policy`     | object           | âŒ        | null                        | ë°°ì¹˜ ì •ì±… ì„¤ì •                                                      |
| `autoscaling`          | object           | âŒ        | null                        | ìë™ í™•ì¥ ì„¤ì •                                                      |
| `create`               | string           | âŒ        | `30m`                       | ë…¸ë“œ í’€ ìƒì„± ì‹œê°„ ì œí•œ                                              |
| `update`               | string           | âŒ        | `30m`                       | ë…¸ë“œ í’€ ì—…ë°ì´íŠ¸ ì‹œê°„ ì œí•œ                                          |
| `delete`               | string           | âŒ        | `30m`                       | ë…¸ë“œ í’€ ì‚­ì œ ì‹œê°„ ì œí•œ                                              |

#### `node_config` ê°ì²´ í•„ë“œ
| í•„ë“œëª…           | íƒ€ì…             | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’                     | ì„¤ëª…                                                              |
|------------------|------------------|-----------|----------------------------|-------------------------------------------------------------------|
| `machine_type`  | string           | âŒ        | `e2-medium`               | ë…¸ë“œ ë¨¸ì‹  íƒ€ì…                                                   |
| `disk_size_gb`  | number           | âŒ        | `100`                     | ë””ìŠ¤í¬ í¬ê¸°                                                      |
| `disk_type`     | string           | âŒ        | `pd-standard`             | ë””ìŠ¤í¬ ìœ í˜•                                                      |
| `image_type`    | string           | âŒ        | `COS_CONTAINERD`          | ì´ë¯¸ì§€ ìœ í˜•                                                      |
| `labels`        | map(string)      | âŒ        | ë¹ˆ ë§µ                      | ë…¸ë“œ ë ˆì´ë¸”                                                      |
| `local_ssd_count`| number           | âŒ        | `0`                       | ë¡œì»¬ SSD ê°œìˆ˜                                                   |
| `metadata`      | map(string)      | âŒ        | `{ disable-legacy-endpoints = true }` | ë…¸ë“œ ë©”íƒ€ë°ì´í„° ì„¤ì •                                             |
| `min_cpu_platform`| string          | âŒ        | null                      | ìµœì†Œ CPU í”Œë«í¼                                                  |
| `oauth_scopes`  | list(string)     | âŒ        | `[\"https://www.googleapis.com/auth/cloud-platform\"]` | OAuth ë²”ìœ„                                                       |
| `preemptible`   | bool             | âŒ        | `false`                   | ì„ ì í˜• ë…¸ë“œ ì—¬ë¶€                                                 |
| `service_account`| string           | âŒ        | null                      | ì„œë¹„ìŠ¤ ê³„ì •                                                      |
| `tags`          | list(string)     | âŒ        | ë¹ˆ ë¦¬ìŠ¤íŠ¸                   | ë„¤íŠ¸ì›Œí¬ íƒœê·¸                                                    |
| `taint`         | list(object)     | âŒ        | ë¹ˆ ë¦¬ìŠ¤íŠ¸                   | Taint ì„¤ì •                                                       |

#### `reservation_affinity` ê°ì²´ í•„ë“œ
| í•„ë“œëª…                  | íƒ€ì…             | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’                     | ì„¤ëª…                                                               |
|-------------------------|------------------|-----------|----------------------------|--------------------------------------------------------------------|
| `consume_reservation_type` | string        | âŒ        | `ANY_RESERVATION`          | ì˜ˆì•½ ë¦¬ì†ŒìŠ¤ ìœ í˜• ì„¤ì •                                              |
| `key`                  | string           | âŒ        | null                       | ì˜ˆì•½ ë¦¬ì†ŒìŠ¤ í‚¤                                                    |
| `values`               | list(string)     | âŒ        | ë¹ˆ ë¦¬ìŠ¤íŠ¸                   | ì˜ˆì•½ ë¦¬ì†ŒìŠ¤ ê°’                                                    |

#### `timeouts` ê°ì²´ í•„ë“œ
| í•„ë“œëª…   | íƒ€ì…   | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’  | ì„¤ëª…                    |
|----------|--------|-----------|---------|-------------------------|
| `create` | string | âŒ        | `30m`   | ìƒì„± ì‘ì—… ì‹œê°„ ì œí•œ     |
| `update` | string | âŒ        | `30m`   | ì—…ë°ì´íŠ¸ ì‘ì—… ì‹œê°„ ì œí•œ |
| `delete` | string | âŒ        | `30m`   | ì‚­ì œ ì‘ì—… ì‹œê°„ ì œí•œ     |

#### `management` ê°ì²´ í•„ë“œ
| í•„ë“œëª…         | íƒ€ì… | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’ | ì„¤ëª…                       |
|----------------|------|-----------|--------|----------------------------|
| `auto_repair`  | bool | âŒ        | `true` | ë…¸ë“œ ìë™ ìˆ˜ë¦¬ ì—¬ë¶€        |
| `auto_upgrade` | bool | âŒ        | `true` | ë…¸ë“œ ìë™ ì—…ê·¸ë ˆì´ë“œ ì—¬ë¶€  |

#### `autoscaling` ê°ì²´ í•„ë“œ
| í•„ë“œëª…                 | íƒ€ì…   | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’ | ì„¤ëª…                     |
|------------------------|--------|-----------|--------|--------------------------|
| `min_node_count`       | number | âŒ        | `1`    | ìµœì†Œ ë…¸ë“œ ìˆ˜             |
| `max_node_count`       | number | âŒ        | `5`    | ìµœëŒ€ ë…¸ë“œ ìˆ˜             |
| `total_min_node_count` | number | âŒ        | null   | ì „ì²´ ìµœì†Œ ë…¸ë“œ ìˆ˜        |
| `total_max_node_count` | number | âŒ        | null   | ì „ì²´ ìµœëŒ€ ë…¸ë“œ ìˆ˜        |

#### `upgrade_settings` ê°ì²´ í•„ë“œ
| í•„ë“œëª…           | íƒ€ì…   | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’ | ì„¤ëª…                                |
|------------------|--------|-----------|--------|-------------------------------------|
| `max_surge`      | number | âŒ        | `1`    | ì—…ê·¸ë ˆì´ë“œ ì¤‘ ì¶”ê°€ ê°€ëŠ¥í•œ ìµœëŒ€ ë…¸ë“œ ìˆ˜ |
| `max_unavailable`| number | âŒ        | `0`    | ì—…ê·¸ë ˆì´ë“œ ì¤‘ ë¹„í™œì„±í™” ê°€ëŠ¥í•œ ìµœëŒ€ ë…¸ë“œ ìˆ˜ |
| `strategy`       | string | âŒ        | `SURGE`| ì—…ê·¸ë ˆì´ë“œ ì „ëµ (ì˜ˆ: `SURGE`)       |

#### `placement_policy` ê°ì²´ í•„ë“œ
| í•„ë“œëª…        | íƒ€ì…   | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’   | ì„¤ëª…                             |
|---------------|--------|-----------|----------|----------------------------------|
| `type`        | string | âŒ        | `COMPACT`| ë°°ì¹˜ ì •ì±… ìœ í˜•                   |
| `policy_name` | string | âŒ        | null     | ì‚¬ìš©ì ì •ì˜ ë¦¬ì†ŒìŠ¤ ì •ì±… ì´ë¦„     |

#### `network_config` ê°ì²´ í•„ë“œ
| í•„ë“œëª…               | íƒ€ì…   | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’ | ì„¤ëª…                              |
|----------------------|--------|-----------|--------|-----------------------------------|
| `create_pod_range`   | bool   | âŒ        | `false`| Pod IPë¥¼ ìœ„í•œ ìƒˆë¡œìš´ ë²”ìœ„ ìƒì„± ì—¬ë¶€ |
| `enable_private_nodes` | bool | âŒ        | `false`| ë…¸ë“œê°€ ë‚´ë¶€ IPë§Œ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •  |
| `pod_ipv4_cidr_block`| string | âŒ        | null   | Pod IP ë²”ìœ„ë¥¼ CIDR í˜•ì‹ìœ¼ë¡œ ì§€ì •  |
| `pod_range`          | string | âŒ        | null   | Pod IPì— ì‚¬ìš©í•  ê¸°ì¡´ ë³´ì¡° ë²”ìœ„    |

<br>

### 3. ëª¨ë“ˆ í˜¸ì¶œ ì˜ˆì‹œ
```hcl
module "gke_node_pool" {
  source = "git::https://github.com/GCP-Terraform-Module-steamedEggMaster/container-node-pool-module.git?ref=v1.0.0"

  cluster              = "example-cluster"
  name                 = "example-node-pool"
  location             = "us-central1-a"
  project              = "example-project"
  initial_node_count   = 2
  management = {
    auto_repair  = true
    auto_upgrade = true
  }

  node_config = {
    machine_type    = "e2-medium"
    disk_size_gb    = 100
    disk_type       = "pd-standard"
    image_type      = "COS_CONTAINERD"
    labels          = { "env" = "production" }
    local_ssd_count = 0
    metadata        = { "disable-legacy-endpoints" = "true" }
  }

  autoscaling = {
    min_node_count = 1
    max_node_count = 5
  }
}
```

<br>

### 4. ì¶œë ¥ê°’ (Outputs)

| ì¶œë ¥ëª…                | ì„¤ëª…                                                                 |
|-----------------------|----------------------------------------------------------------------|
| `id`                 | ìƒì„±ëœ ë…¸ë“œ í’€ì˜ IDì…ë‹ˆë‹¤.                                           |
| `name`               | ë…¸ë“œ í’€ì˜ ì´ë¦„ì…ë‹ˆë‹¤.                                               |
| `location`           | ë…¸ë“œ í’€ì´ ë°°ì¹˜ëœ ìœ„ì¹˜ì…ë‹ˆë‹¤.                                         |
| `instance_group_urls`| ë…¸ë“œ í’€ì— ì—°ê²°ëœ ê´€ë¦¬ ì¸ìŠ¤í„´ìŠ¤ ê·¸ë£¹ì˜ URL ëª©ë¡ì…ë‹ˆë‹¤.                 |
| `node_config`        | ë…¸ë“œ í’€ êµ¬ì„± ë§¤ê°œë³€ìˆ˜ì…ë‹ˆë‹¤.                                         |
| `autoscaling`        | ë…¸ë“œ í’€ì˜ ìë™ í™•ì¥ ì„¤ì •ì…ë‹ˆë‹¤.                                      |
| `management`         | ë…¸ë“œ í’€ ê´€ë¦¬ ì„¤ì •ì…ë‹ˆë‹¤.                                            |

<br>

### 5. ì§€ì› ë²„ì „

#### a.  Terraform ë²„ì „
| ë²„ì „ ë²”ìœ„ | ì„¤ëª…                              |
|-----------|-----------------------------------|
| `1.10.3`   | ìµœì‹  ë²„ì „, ì§€ì› ë° í…ŒìŠ¤íŠ¸ ì™„ë£Œ                  |

#### b. Google Provider ë²„ì „
| ë²„ì „ ë²”ìœ„ | ì„¤ëª…                              |
|-----------|-----------------------------------|
| `~> 6.0`  | ìµœì†Œ ì§€ì› ë²„ì „                   |

<br>

### 6. ëª¨ë“ˆ ê°œë°œ ë° ê´€ë¦¬

- **ì €ì¥ì†Œ êµ¬ì¡°**:
  ```
  container-node-pool-module/
  â”œâ”€â”€ .github/workflows/  # github actions ìë™í™” í…ŒìŠ¤íŠ¸
  â”œâ”€â”€ examples/           # í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë£¨íŠ¸ ëª¨ë“ˆ ëª¨ìŒ ë””ë ‰í„°ë¦¬
  â”œâ”€â”€ test/               # í…ŒìŠ¤íŠ¸ êµ¬ì„± ë””ë ‰í„°ë¦¬
  â”œâ”€â”€ main.tf             # ëª¨ë“ˆì˜ í•µì‹¬ êµ¬í˜„
  â”œâ”€â”€ variables.tf        # ì…ë ¥ ë³€ìˆ˜ ì •ì˜
  â”œâ”€â”€ outputs.tf          # ì¶œë ¥ ì •ì˜
  â”œâ”€â”€ versions.tf         # ë²„ì „ ì •ì˜
  â”œâ”€â”€ README.md           # ë¬¸ì„œí™” íŒŒì¼
  ```
<br>

---

## Terratestë¥¼ ì´ìš©í•œ í…ŒìŠ¤íŠ¸
ì´ ëª¨ë“ˆì„ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ì œê³µëœ Go ê¸°ë°˜ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. ì•„ë˜ë¥¼ í™•ì¸í•˜ì„¸ìš”:

1. Terraform ë° Go ì„¤ì¹˜.
2. í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (GCP_PROJECT_ID, API_SERVICES ë“±).
3. í…ŒìŠ¤íŠ¸ ì‹¤í–‰:
```bash
go test -v ./test
```

<br>

## ì£¼ìš” ë²„ì „ ê´€ë¦¬
ì´ ëª¨ë“ˆì€ [Semantic Versioning](https://semver.org/)ì„ ë”°ë¦…ë‹ˆë‹¤.  
ì•ˆì •ëœ ë²„ì „ì„ ì‚¬ìš©í•˜ë ¤ë©´ `?ref=<version>`ì„ í™œìš©í•˜ì„¸ìš”:

```hcl
source = "git::https://github.com/GCP-Terraform-Module-steamedEggMaster/container-node-pool-module.git?ref=v1.0.0"
```

### Module ref ë²„ì „
| Major | Minor | Patch |
|-----------|-----------|----------|
| `1.0.0`   |    |   |


<br>

## ê¸°ì—¬ (Contributing)
ê¸°ì—¬ë¥¼ í™˜ì˜í•©ë‹ˆë‹¤! ë²„ê·¸ ì œë³´ ë° ê¸°ëŠ¥ ìš”ì²­ì€ GitHub Issuesë¥¼ í†µí•´ ì œì¶œí•´ì£¼ì„¸ìš”.

<br>

## ë¼ì´ì„ ìŠ¤ (License)
[MIT License](LICENSE)